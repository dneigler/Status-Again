@using System.Collections.Concurrent
@using Status.Model
@using StatusMvc.Extensions
@{
    ViewBag.Title = "Index";
}
@section HeadSection {
    <script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/knockout-1.3.0beta.js")" type="text/javascript"></script>
    <script src="@Url.Content("~/Scripts/core/StatusReport.js")" type="text/javascript"></script>
}
<h2>@ViewBag.Message</h2>
<form data-bind="submit: addReport">
<fieldset>
    <legend>Status Report</legend>
    <p>
        Date:
        <input type="text" data-bind="value: PeriodStartFormatted" />
    </p>
    <p>
        Caption:
        <input type="text" data-bind="value: Caption" />
    </p>
    <p>
        Items: <span data-bind="value: NumberOfStatusItems"></span>
    </p>
</fieldset>
<fieldset>
    <legend>Items</legend>New Status Item:
    <input type="text" data-bind='value: StatusItemToAdd, valueUpdate: "afterkeydown"' />
    <input type="text" data-bind='value: StatusItemDateToAdd, valueUpdate: "afterkeydown"' />
    @Html.DropDownList("MilestoneTypes", MilestoneTypes.Milestone.ToSelectList(), "(none)",
            new Dictionary<string, object> { { "data-bind", "value:StatusItemMilestoneToAdd" } })
    <button type="submit" data-bind="enable: StatusItemToAdd().length > 0, click: addStatusItem">
        Add</button>
</fieldset>
<fieldset>
    <legend>Status Items</legend>
    <table data-bind="visible: Items().length > 0">
        <thead>
            <tr>
                <th>
                    Caption
                </th>
                <th>
                    Project Name
                </th>
                <th>
                    Milestone Type
                </th>
                <th>
                    Date
                </th>
                <th>
                    Lead Name
                </th>
                <th>
                    Confidence
                </th>
                <th>
                    Action
                </th>
            </tr>
        </thead>
        <tbody data-bind='template: { name: "statusItemRowTemplate", foreach: Items }'>
        </tbody>
    </table>
</fieldset>
<input type="submit" value="Create" />
</form>
<script type="text/html" id="statusItemRowTemplate">
    <tr>
        <td><input class="required" data-bind="value: Caption, uniqueName: true"/></td>
        <td><input class="required" data-bind="value: ProjectName, uniqueName: true"/></td>
        <td>
            @Html.DropDownList("MilestoneTypes", MilestoneTypes.Milestone.ToSelectList(), "(none)",
            new Dictionary<string, object> { { "data-bind", "value:MilestoneType" } })</td>
        <td><input class="required" data-bind="value: MilestoneDate, uniqueName: true"/></td>
        <td><input class="required" data-bind="value: ProjectLeadFullName, uniqueName: true"/></td>
        <td><input class="required" data-bind="value: MilestoneConfidenceLevel, uniqueName: true"/></td>
        <td><a href="#" data-bind="click: function() { viewModel.removeStatusItem($data) }">Delete</a></td>
    </tr>
</script>
<script type="text/javascript">
    $(function () {
        //activates KO
        ko.applyBindings(statusReport);
    });
</script>
